--- 
title: "Synthetic population generation for ACRES project"
author: "Flannery Black-Ingersoll and Chad Milando"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [articles.bib, packages.bib, zotero.bib]
biblio-style: apalike
link-citations: yes
github-repo: rstudio/bookdown-demo
description: "This book describes the process and applications of using the CO model to create a synthetic population for MyWRA, and estimate the impact of climate-change adaptation efforts."
---

# Prerequisites

Here we will describe the overall purpose of the project, with some links.
and probably embed and image or two.
```{r include=FALSE}
library(tigris)
library(leaflet) #https://rstudio.github.io/leaflet/basemaps.html
library(sf)
```

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}


MA_pumas <- pumas(state = "MA", year = 2021)
pumas <- c("00503","00505","02800","01000","00508","00507","00506","03302",
           "00505","03302","03306","01300")
MA_pumas_mywra <- subset(MA_pumas, MA_pumas$PUMACE10 %in% pumas)
MA_tracts <- tracts(state = "MA", year = 2021)
intersect_sgbp <- st_intersects(MA_tracts, MA_pumas_mywra) #following method found: https://bookdown.org/robinlovelace/geocompr/spatial-operations.html
sel_logical = lengths(intersect_sgbp) > 0
MA_tracts_mywra = MA_tracts[sel_logical, ]
exclude<-c("367200","367100","366201","365100","361100","361300","362100","317103","317102","312300","312502","314301","314302","252102","252101","251400","251500","251800","251700","253202","253204","212102","212101","214100","216100","217102","217201","217202","204600","204702","204701","205100","205300","205400","205600","205700","207200","990101","060604","061204","061203","061202","080100","080401","080601","010405","010404","010403","010206","010104","981501","373100","373200","373300","374500","374600","374700","205800","080500","312501")
MA_tracts_mywra <- MA_tracts_mywra[!(MA_tracts_mywra$TRACTCE %in% exclude),]
pumapal <- colorFactor(palette = 
                          c('beige', 'blue', 'cadetblue', 'darkgreen',  'purple4', 'darkred',  'lightblue', 'lightgray', 'lightgreen', 'orange','red'), domain = NULL)
map_1 <- leaflet() %>%
  setView(lat = 42.48, lng = -71.09, zoom = 10) %>%
  addProviderTiles(
    providers$Esri.WorldTopoMap,
    options = providerTileOptions(opacity = 0.75),
    group = "ESRI World Topographic") %>%
   addProviderTiles(
    providers$Esri.WorldGrayCanvas,
    options = providerTileOptions(opacity = 0.75),
    group = "ESRI World Gray Canvas") %>%
  addProviderTiles(
    providers$Esri.WorldImagery,
    options = providerTileOptions(opacity = 0.75),
    group = "ESRI World Imagery") %>%
  addPolygons(
    data = MA_tracts_mywra,
    # set the color of the polygon
    fill = FALSE,
    stroke = TRUE,
    color = "red",
    opacity = 0.5,
    weight = 0.5,
    group = "Census Tracts",
    popup = ~TRACTCE
  ) %>%
  addPolygons(
    data = MA_pumas_mywra,
    # set the color of outlines
    stroke = T,
    color = "black",
    fill = T,
    fillColor = ~pumapal(MA_pumas_mywra$NAMESLSAD10),
    fillOpacity = 0.01,
    # set the opacity of the outline
    # set the stroke width in pixels
    weight = 1.4,
    dashArray = "2",
    
    group = "Public Use Microdata Areas",
    popup = ~NAMELSAD10

  ) %>%
  # Layers control
  addLayersControl(
    baseGroups = c("ESRI World Topographic",
                   "ESRI World Gray Canvas",
                   "ESRI World Imagery"),
    overlayGroups = c("Public Use Microdata Areas","Census Tracts"),
    options = layersControlOptions(collapsed = FALSE)
  )
# side note... look how beautiful this is: -->
# leaflet() %>% 
# setView(lat = 42.40, lng = -71.09713377834885, zoom = 10) %>% 
# addProviderTiles(providers$Stamen.Watercolor) 
```

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
map_1
```


