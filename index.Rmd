--- 
title: "Synthetic population generation for ACRES project"
author: "Flannery Black-Ingersoll and Chad Milando"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [articles.bib, packages.bib, zotero.bib]
biblio-style: apalike
link-citations: yes
github-repo: rstudio/bookdown-demo
description: "This book describes the process and applications of using the CO model to create a synthetic population for MyWRA, and estimate the impact of climate-change adaptation efforts."
---

# Prerequisites

Here we will describe the overall purpose of the project, with some links.
and probably embed and image or two.
```{r include=FALSE}
library(tigris)
library(leaflet) #https://rstudio.github.io/leaflet/basemaps.html
library(sf)
library(dplyr)
library(utils)
library(readr)
```

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}


MA_pumas <- pumas(state = "MA", year = 2021)
pumas <- c("00503","00505","02800","01000","00508","00507","00506","03302","00505","03302","03306","01300")
MA_pumas_mywra <- subset(MA_pumas, MA_pumas$PUMACE10 %in% pumas)
MA_tracts <- tracts(state = "MA", year = 2021)

#Spatial join by tract centroids
centroids_tracts <- st_centroid(MA_tracts)
join_PUMA_centroids <- st_join(centroids_tracts, MA_pumas_mywra)
join_PUMA_centroids<- join_PUMA_centroids[!is.na(join_PUMA_centroids$STATEFP10),]
# Now, make a dictionary 
PUMA_tracts <- as.data.frame(cbind(join_PUMA_centroids$TRACTCE,
                                join_PUMA_centroids$PUMACE10))
PUMA_tracts <- rename(PUMA_tracts, TRACTCE = V1) 
PUMA_tracts <- rename(PUMA_tracts, PUMACE10 = V2) 
unique(PUMA_tracts$PUMACE10)
    # Save this dictionary
write_csv(PUMA_tracts, "pumas_and_ctracts.csv")

# Join dictionary to tracts file
MA_tracts_mywra <- right_join(MA_tracts, PUMA_tracts, by = "TRACTCE")

map_1 <- leaflet() %>%
  setView(lat = 42.48, lng = -71.09, zoom = 10) %>%
  addProviderTiles(
    providers$Esri.WorldTopoMap,
    options = providerTileOptions(opacity = 0.75),
    group = "ESRI World Topographic") %>%
   addProviderTiles(
    providers$Esri.WorldGrayCanvas,
    options = providerTileOptions(opacity = 0.75),
    group = "ESRI World Gray Canvas") %>%
  addProviderTiles(
    providers$Esri.WorldImagery,
    options = providerTileOptions(opacity = 0.75),
    group = "ESRI World Imagery") %>%
  addPolygons(
    data = MA_tracts_mywra,
    # set the color of the polygon
    fill = FALSE,
    stroke = TRUE,
    color = "red",
    opacity = 0.5,
    weight = 0.5,
    group = "Census Tracts",
    popup = ~TRACTCE
  ) %>%
    addPolygons(
    data = MA_pumas_mywra,
    # set the color of outlines
    stroke = T,
    color = "black",
    fill = F,
    # set the opacity of the outline
    # set the stroke width in pixels
    weight = 1.4,
    group = "Public Use Microdata Areas",
    popup = ~NAMELSAD10
   ) %>%
  # Layers control
  addLayersControl(
    baseGroups = c("ESRI World Topographic",
                   "ESRI World Gray Canvas",
                   "ESRI World Imagery"),
    overlayGroups = c("Public Use Microdata Areas",
                      "Census Tracts"
                      ),
    options = layersControlOptions(collapsed = FALSE)
  )




# side note... look how beautiful this is: -->
# leaflet() %>%
# setView(lat = 42.40, lng = -71.09713377834885, zoom = 10) %>%
# addProviderTiles(providers$Stamen.Watercolor)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
map_1
```


